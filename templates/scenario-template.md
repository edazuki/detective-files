# シナリオ制作テンプレート

このファイルを参考に、シナリオフォルダ内の各ファイルを作成してください。
シナリオフォルダは `scenarios/[事件番号_タイトル]/` に置きます。

---

## フォルダ構成

```
scenarios/
└── 事件XX_タイトル/
    ├── scenario.md        ← このテンプレートのセクション1
    ├── characters.md      ← このテンプレートのセクション2
    ├── clues.md           ← このテンプレートのセクション3
    └── truth.md           ← このテンプレートのセクション4
```

---

## セクション1: scenario.md

```markdown
# シナリオ: [タイトル]

## シナリオへの特別指示（省略可）
[残酷描写がある場合の警告など]

---

## 導入テキスト

> [プレイヤーに最初に提示する状況説明。
>  「あなたは〜」の視点で書くと没入感が出る]

---

## 登場人物

- **[名前]**（役割、年齢）：[一言説明]

---

## 場所一覧

### [場所名]
- **アクセス条件**: [なし / フラグ名 / 好感度条件]
- **調査したとき**: `[flag_name]` フラグを立てる
- **調査できること**:
  - [アクション] → [結果・取得できる証拠]

---

## フラグ一覧

| フラグID | 意味 |
|---|---|
| `[flag_name]` | [説明] |

---

## クリア条件

- **最低証拠ファイル数**: [数字]
- **推奨フラグ**: [フラグ名のリスト]

---

## バッドエンド条件

| 条件 | エンド |
|---|---|
| [条件] | [結果] |

---

## ビューアーテーマ（省略可）

省略した場合はデフォルトテーマが適用される。

```yaml
theme:
  accent: "#[hex]"        # アクセントカラー（見出し・ボーダー等）
  bg_tint: "#[hex]"       # 背景色
  text_primary: "#[hex]"  # 本文テキスト色
  font: "[font-stack]"    # フォント指定（例: "Georgia, serif"）
  label: "[label]"        # ビューアー上部に表示されるラベル（例: "Victorian"）
```
```

---

## セクション2: characters.md

```markdown
# 登場人物定義

---

## [キャラクター名]（役割）

\`\`\`yaml
id: [snake_case_id]
name: [名前]
role: [役割]
age: [年齢]
status: active            # active / deceased / deceased_when: [flag_name]
affinity_initial: [0-100]
trust_initial: [0-100]
affinity_change:
  [ポジティブなイベント]: +[数値]
  [ネガティブなイベント]: -[数値]
trust_change:
  [ポジティブなイベント]: +[数値]
  [ネガティブなイベント]: -[数値]

knowledge:
  initial:
    - "[このキャラクターが最初から知っていること]"
  concealed:
    - "[このキャラクターが意図的に隠していること]"
# acquired_knowledge はプレイ中に state.yml で管理（characters.md には書かない）

phases:
  - id: default
    condition: {}
    behavior: "[デフォルトの行動指針・態度]"
  - id: [phase_name]
    condition:
      flag_required: [flag_name]   # フラグ条件（省略可）
      affinity_[character_id]: [数値]  # 好感度条件（省略可）
    behavior: "[この局面での行動指針・態度の変化]"
\`\`\`

**人物像**: [性格・背景・秘密]

**会話トピック**:

- **[トピック名]**（条件: [なし / フラグ名 / affinity_xxx ≥ N]）
  - `sets_flag`: [flag_name]（省略可）
  - `reveals`: "[このトピックで話してくれる内容]"
```

---

## セクション3: clues.md

```markdown
# 証拠定義

\`\`\`yaml
clues:

  - id: [snake_case_id]
    dest: evidence/[id].[ext]             # 生成ファイルの保存先。ファイル名stem = id に統一する
    condition:
      location: [場所名]                  # 場所条件
      action: [アクションの説明]           # 自然言語でどんな行動が必要か
      flag_required: [flag_name]          # 事前に必要なフラグ（省略可）
      affinity_[character_id]: [数値]     # 好感度条件（省略可）
    proves: "[この証拠が証明する内容。AIがファイル生成時に含める核心情報]"
    acquisition_context: "[入手の経緯・文書の性質についてのメモ（省略可）]"
    # ⚠️ 入手条件と入手できる物の対応が不自然でないか確認すること。
    # 例：鑑定書なら「依頼後に入手」、目撃証言なら「その場で聴取」など。
    sets_flag: [flag_name]               # 取得時に立てるフラグ（省略可）
    initial: false   # true にするとセッション開始時に条件なしで自動生成（省略時 false）
    display_name: "[プレイヤーへの表示名（日本語推奨）]"  # 省略可
    description: "[AIが内容を参照する際の補足説明（省略可）]"
    hint_level: high / medium / low
    supports:
      - [この証拠が支持する主張]
\`\`\`
```

---

## セクション4: truth.md

```markdown
# 真相ファイル

> ⚠️ このファイルはAIのみが参照します。プレイヤーには絶対に開示しないでください。

---

## 想定解

### 犯人
[犯人の名前]

### 動機
[動機の詳細]

### 方法
[犯行の手順]

---

## 解決判定の基準

### キーパーソン
- **[キャラクター名]**
  - affinity_threshold: [数値], trust_threshold: [数値]

### 最低証拠ファイル数
`evidence/` 内に **[数字]ファイル以上**（聴取メモ含む）

### 証明ポイント

| ポイント | 条件 |
|---|---|
| P1: [証明すべき事項] | [対応する証拠ID] |
| P2: [証明すべき事項] | [対応する証拠ID] |
| P3: [証明すべき事項] | [対応する証拠ID] |

### 判定閾値

| 充足率 | 条件 | 結果 |
|---|---|---|
| [X/X]（100%） | なし | 完全解決 |
| [X/X]（〇〇%） | なし | 解決 |
| [X/X]（〇〇%） | affinity ≥ [N] かつ trust ≥ [N] | 条件付き解決 |
| [X/X]以下 | — | 却下 |

---

## ボーナス演出テキスト（省略可）
[想定解と完全一致した場合のエンディングテキスト]

---

## AIへの注意事項
[プレイヤーへの誘導を禁ずる事項を記載]
```

---

## トリック・証拠の設計順序

犯人視点で「**何を隠したいか → どうやって隠すか → どうやって暴かれるか**」の順に設計する。

- 犯人の行動は「隠したいものがあるから取った手段」として導出する。行動だけ先に決めない
- 「暴かれ方」まで設計して初めて、その証拠をどこに配置するかが決まる
- 証拠の `proves` と `condition` はこの順序から自然に導けるはず。逆算できない場合はトリックの設計を見直す

---

## 証拠充足ポイントの設計指針

`truth.md` の「証明ポイント」に何を入れるか迷ったときの参考例。すべてが必要なわけではなく、シナリオの構造に合ったものだけ定義する。

| 参考項目 | 内容 |
|---|---|
| 死因・犯行方法 | どのように犯行が実行されたか |
| メインカラクリ | 密室・アリバイ等、事件の核心となる謎の解明 |
| 動機 | なぜ犯人が犯行に及んだか |
| 犯人と現場の接続 | 犯人が犯行現場にいたことの証明 |
| 見せかけの否定 | 自殺・事故・他者の犯行に見せかけた場合、その否定 |

証拠の `supports:` にはここで定義したポイントのIDを記載すると、解決判定の整合性確認に使いやすい。

---

## 証拠ファイルの作り方のヒント

| ファイル形式 | 向いている用途 | 例 |
|---|---|---|
| `.txt` | メモ・手紙・日記・分析結果 | 日記、帳簿、証言メモ |
| `.html` | 正式書類・複雑なレイアウト | 検死レポート、新聞記事 |
| `.md` | 読みやすい書式の文書 | 報告書、まとめ |
| `.jpg/.png` | 写真証拠・地図・図面 | 現場写真、地図（マルチモーダルAI推奨） |

証拠ファイルは「プレイヤーが実際に開いたとき、生々しくリアルに感じられる」内容にすると没入感が増します。

---

## 設計補助ツール：証拠-主張マトリクス

シナリオ設計時に「各証拠がどの主張を支持・否定できるか」を整理するためのマトリクスです。
これを埋めることで、別解が成立しうるか、または証拠の穴がないかを事前確認できます。

**作成方法**: 横軸に主張（犯人・動機・方法の要素）、縦軸に証拠IDを置き、`◎`（強く支持）・`○`（支持）・`△`（間接的）・`✗`（矛盾・否定）を記入する。

```markdown
## 証拠-主張マトリクス（シナリオ設計メモ）

| 証拠ID | 犯人=A | 犯人=B | 動機=X | 動機=Y | 方法=P | 密室解明 |
|---|---|---|---|---|---|---|
| evidence_01 | ◎ | — | ○ | — | — | — |
| evidence_02 | △ | ✗ | — | ◎ | — | — |
| interview_B | — | ◎ | — | — | ○ | — |
| ...         |   |   |   |   |   |   |

> **読み方**: ◎=強く支持, ○=支持, △=間接的/弱い支持, ✗=矛盾・否定, —=無関係
```

**チェックポイント**:
- 想定解（犯人A・動機X・方法P）の列が十分な `◎` `○` で埋まっているか？
- 別解（犯人B）の列が成立してしまう証拠ばかり揃っていないか？
- `✗` が少なすぎる場合、「何でもクリアできる」シナリオになっている可能性がある
- 別解を意図的に許容する設計にする場合は、その旨を `truth.md` に記載する
